'use strict';var _temporalUndefined={},Geosuggest=_temporalUndefined;function _interopRequireDefault(a){return a&&a.__esModule?a:{'default':a}}function _temporalAssertDefined(a,b,c){if(a===c)throw new ReferenceError(b+' is not defined - temporal dead zone');return!0}var _react=require('react'),fuzzysearch=require('fuzzysearch'),_react2=_interopRequireDefault(_react),_GeosuggestItem=require('./Geosuggestitemdist'),_GeosuggestItem2=_interopRequireDefault(_GeosuggestItem);Geosuggest=_react2['default'].createClass({displayName:'Geosuggest',getDefaultProps:function(){var b='undefined'!=typeof google&&'undefined'!=typeof google.maps;return{fixtures:[],initialValue:'',placeholder:'Search places',disabled:!1,className:'',location:null,radius:0,bounds:null,country:null,types:null,customLocations:null,googleMaps:b?google&&google.maps:null,onSuggestSelect:function(){},onFocus:function(){},onBlur:function(){},onChange:function(){},skipSuggest:function(){},getSuggestLabel:function(d){return d.description}}},getInitialState:function(){return{isSuggestsHidden:!0,userInput:this.props.initialValue,activeSuggest:null,suggests:[],geocoder:this.props.googleMaps?new this.props.googleMaps.Geocoder:null,autocompleteService:this.props.googleMaps?new this.props.googleMaps.places.AutocompleteService:null}},componentWillReceiveProps:function(b){this.props.initialValue!==b.initialValue&&this.setState({userInput:b.initialValue})},onInputChange:function(){var b=this.refs.geosuggestInput.getDOMNode().value;this.setState({userInput:b},function(){this.showSuggests(),this.props.onChange(b)}.bind(this))},onFocus:function(){this.props.onFocus(),this.showSuggests()},update:function(b){this.setState({userInput:b}),this.props.onChange(b)},clear:function(){this.setState({userInput:''},function(){this.hideSuggests()}.bind(this))},searchSuggests:function(){if(!this.state.userInput)return void this.updateSuggests();var b=this.searchCustomSuggests(),c={input:this.state.userInput,location:this.props.location||new this.props.googleMaps.LatLng(0,0),radius:this.props.radius};this.props.bounds&&(c.bounds=this.props.bounds),this.props.types&&(c.types=this.props.types),this.props.country&&(c.componentRestrictions={country:this.props.country}),this.state.autocompleteService.getPlacePredictions(c,function(d){this.updateSuggests(d,b)}.bind(this))},searchCustomSuggests:function(){var b=[];return this.props.customLocations&&3<this.state.userInput.length&&fuzzysearch(this.state.userInput,this.props.customLocations)&&b.push({key:key,data:this.props.customLocations[key]}),b},updateSuggests:function(b,c){var d=this;b||(b=[]),c||(c=[]);var e=[],f=new RegExp(this.state.userInput,'gim'),g=this.props.skipSuggest;this.props.fixtures.forEach(function(h){!g(h)&&h.label.match(f)&&(h.placeId=h.label,e.push(h))}),c.forEach(function(h){e.push({label:h.key,type:'custom',location:h.data,placeId:h.key})}),b.forEach(function(h){g(h)||e.push({label:d.props.getSuggestLabel(h),type:'google',placeId:h.place_id})}),this.setState({suggests:e})},showSuggests:function(){this.searchSuggests(),this.setState({isSuggestsHidden:!1})},hideSuggests:function(){this.props.onBlur(),setTimeout(function(){this.setState({isSuggestsHidden:!0})}.bind(this),100)},onInputKeyDown:function(b){switch(b.which){case 40:b.preventDefault(),this.activateSuggest('next');break;case 38:b.preventDefault(),this.activateSuggest('prev');break;case 13:b.preventDefault(),this.selectSuggest(this.state.activeSuggest);break;case 9:this.selectSuggest(this.state.activeSuggest);break;case 27:this.hideSuggests();break;default:}},activateSuggest:function(b){if(this.state.isSuggestsHidden)return void this.showSuggests();var c=this.state.suggests.length-1,d='next'===b,e=null,f=0,g=0;for(g;g<=c;g++)this.state.suggests[g]===this.state.activeSuggest&&(f=d?g+1:g-1);this.state.activeSuggest||(f=d?0:c),0<=f&&f<=c&&(e=this.state.suggests[f]),this.setState({activeSuggest:e})},selectSuggest:function(b){var c=!1;return b&&this.state.suggests.map(function(d){-1<d.label.indexOf(b.label)&&(c=!0)}.bind(this)),!b&&this.state.suggests.length||!c&&this.state.suggests.length?(b=this.state.suggests[0],this.setState({activeSuggest:null})):!b&&(b={label:this.state.userInput}),this.setState({isSuggestsHidden:!0,userInput:b.label}),b.location?void this.props.onSuggestSelect(b):void('google'===b.type?this.geocodeSuggest(b):this.props.onSuggestSelect(b))},geocodeSuggest:function(b){this.state.geocoder.geocode({address:b.label},function(c,d){if(d===this.props.googleMaps.GeocoderStatus.OK){var e=c[0],f=e.geometry.location;b.type='google',b.gmaps=e,b.location={lat:f.lat(),lng:f.lng()},this.props.onSuggestSelect(b)}}.bind(this))},render:function(){return _react2['default'].createElement('div',{className:'geosuggest '+this.props.className,onClick:this.onClick},_react2['default'].createElement('input',{className:'geosuggest__input',ref:'geosuggestInput',type:'text',value:this.state.userInput,placeholder:this.props.placeholder,disabled:this.props.disabled,onKeyDown:this.onInputKeyDown,onChange:this.onInputChange,onFocus:this.onFocus,onBlur:this.hideSuggests}),_react2['default'].createElement('ul',{className:this.getSuggestsClasses()},this.getSuggestItems(),this.poweredByGoogle()))},poweredByGoogle:function(){var b=_temporalUndefined;return b=_react2['default'].createElement('div',{className:'poweredByGoogle'}),_react2['default'].createElement(_GeosuggestItem2['default'],{key:'google-logo',suggest:{label:_temporalAssertDefined(b,'google',_temporalUndefined)&&b},isActive:!1,onSuggestSelect:function onSuggestSelect(){}})},getSuggestItems:function(){return this.state.suggests.map(function(b){var c=this.state.activeSuggest&&b.placeId===this.state.activeSuggest.placeId;return _react2['default'].createElement(_GeosuggestItem2['default'],{key:b.placeId,suggest:b,isActive:c,onSuggestSelect:this.selectSuggest})}.bind(this))},getSuggestsClasses:function(){var b='geosuggest__suggests';return b+=this.state.isSuggestsHidden?' geosuggest__suggests--hidden':'',b}}),module.exports=_temporalAssertDefined(Geosuggest,'Geosuggest',_temporalUndefined)&&Geosuggest;